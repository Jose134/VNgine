!function(){let e=null,t=document.getElementById("vngine-div"),n=null,i=null,a=null,d=null,l=null,r=null,c=null,s=null,o=[],g=[],u=null,m=[],v=[],p=[],h=[],f=null,b=null,L=0,E=0;let x=100,y=!1,A=!1,k=null,C=[];function T(e){switch(n.style.display="none",a.style.display="none",i.style.display="none",d.style.display="none",l.style.display="none",e){case"loading":n.style.display="block";break;case"menu":a.style.display="block";break;case"game":i.style.display="block";break;case"settings":d.style.display="block";break;case"savefiles":l.style.display="block"}}function w(t){if(b=e.nodes[t],L=t,b){if(f!=b.background&&(i.style.background=`url("game/res/img/backgrounds/${b.background}")`,f=b.background),!O(b.charactersRight,p)&&(Array.from(o).forEach(e=>{e.setAttribute("src",""),e.setAttribute("data-character","")}),b.charactersRight)){for(let t=0;t<b.charactersRight.length;t++){let n=b.charactersRight[t],i=`game/res/img/characters/${e.characters[n].pictures[0]}`;if(null==o[t]||null==o[t]){let e=document.createElement("img");e.classList.add("vngine-character","vngine-character-right"),s.append(e),o[t]=e}o[t].setAttribute("data-character",n),o[t].setAttribute("src",i)}p=b.charactersRight}if(!O(b.charactersLeft,h)&&(Array.from(g).forEach(e=>{e.setAttribute("src",""),e.setAttribute("data-character","")}),b.charactersLeft)){for(let t=0;t<b.charactersLeft.length;t++){let n=b.charactersLeft[t],i=`game/res/img/characters/${e.characters[n].pictures[0]}`;if(null==g[t]||null==g[t]){let e=document.createElement("img");e.classList.add("vngine-character","vngine-character-left"),s.append(e),g[t]=e}g[t].setAttribute("data-character",n),g[t].setAttribute("src",i)}h=b.charactersLeft}if(b.decision){u.innerHTML="",m.splice(0,m.length);for(let e=0;e<v.length;e++)document.removeEventListener("click",v[e]);v.splice(0,v.length);for(let e=0;e<b.decision.length;e++)m.push(document.createElement("button")),m[e].classList.add("vngine-btn"),m[e].innerText=b.decision[e].text,m[e].setAttribute("id",`vngine-decision-btn-${e}`),v[e]=function(t){t.target&&t.target.id==`vngine-decision-btn-${e}`&&w(b.decision[e].targetNode)},document.addEventListener("click",v[e]),u.appendChild(m[e]);u.style.display="block"}else b.dialog&&(u.style.display="none",E=0,I())}else console.error(`VNGINE_ERROR: Couldn't load game node with id ${t}`)}function I(){let t=b.dialog[E].character,n=b.dialog[E].changeCharacterPicture;n&&n.forEach(t=>{let n=function(e){let t=Array.from(g).concat(Array.from(o));for(let n=0;n<t.length;n++)if(t[n].getAttribute("data-character")==e)return t[n];return null}(t.character);if(null!=n){let i=`game/res/img/characters/${e.characters[t.character].pictures[t.picture]}`;n.setAttribute("src",i)}}),r.innerText=e.characters[t].name,async function(e){let t=Array.from(e),n="";y=!0,c.innerText="";for(let e=0;e<t.length;e++){if(!y)return;n+=t[e]," "==t[e]&&(n+=t[++e]),c.innerText=n,await R(x)}E++,y=!1}(b.dialog[E].text)}function S(){y=!1,c.innerText=b.dialog[E].text,E++}function N(){if(b.dialog)if(y)S();else if(E>=b.dialog.length){if(!b.nextNode)return;w(b.nextNode)}else I()}function $(e){let t=localStorage.getItem(e);if(t&&(w((t=JSON.parse(t)).nodeIndex),b.dialog))for(;E<t.dialogIndex;)I(),S();T("game")}function R(e){return new Promise(t=>setTimeout(t,e))}function O(e,t){return Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every((e,n)=>e===t[n])}window.onload=function(){if(!t)return void console.error("VNGINE_ERROR: no element with id 'vngine-div' was found!");let o=t.getAttribute("data-game-file");o||(o="game/game.json"),e=gameJSON,function(){(n=document.createElement("div")).setAttribute("id","vngine-loading"),n.classList.add("vngine-screen","vngine-loading");let e=document.createElement("div");e.classList.add("vngine-loading-text-wrapper");let i=document.createElement("h1");i.classList.add("vngine-loading-text"),i.innerText="Loading...",e.appendChild(i),n.appendChild(e),t.appendChild(n)}(),function(){(i=document.createElement("div")).setAttribute("id","vngine-game"),i.classList.add("vngine-screen","vngine-game");let e=document.createElement("div");e.setAttribute("id","vngine-game-click-detector"),e.classList.add("vngine-game-click-detector"),document.addEventListener("click",e=>{e.target&&"vngine-game-click-detector"==e.target.id&&N()}),(u=document.createElement("div")).classList.add("vngine-btn-group"),(s=document.createElement("div")).classList.add("vngine-characters-div");let n=document.createElement("div");n.classList.add("vngine-dialog-box"),(r=document.createElement("p")).classList.add("vngine-dialog-character"),(c=document.createElement("p")).classList.add("vngine-dialog-text");let a=document.createElement("div");a.classList.add("vngine-option-text-container");let d=document.createElement("a");d.innerText="Save",d.classList.add("vngine-option-text"),d.setAttribute("id","saveText"),document.addEventListener("click",e=>{if(e.target&&"saveText"==e.target.id){let e=new Date,t=e.getUTCFullYear()+"-"+e.getMonth()+"-"+e.getDay()+"   "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();!function(e){if(!e)return;let t={nodeIndex:L,dialogIndex:E-1};localStorage.setItem(e,JSON.stringify(t))}(t)}});let l=document.createElement("a");l.innerText="Load",l.classList.add("vngine-option-text"),l.setAttribute("id","loadText"),document.addEventListener("click",e=>{e.target&&"loadText"==e.target.id&&T("savefiles")});let o=document.createElement("a");o.innerText="Skip",o.classList.add("vngine-option-text"),a.appendChild(d),a.appendChild(l),a.appendChild(o),n.appendChild(r),n.appendChild(c),i.appendChild(a),i.appendChild(e),i.appendChild(u),i.appendChild(s),i.appendChild(n),t.appendChild(i)}(),function(){(a=document.createElement("div")).setAttribute("id","vngine-menu"),a.classList.add("vngine-screen","vngine-menu"),a.style.display="none";let e=document.createElement("div");e.classList.add("vngine-btn-group");let n=document.createElement("button");n.innerText="New Game",n.classList.add("vngine-btn"),n.setAttribute("id","vngine-menu-newgame-btn"),document.addEventListener("click",e=>{e.target&&"vngine-menu-newgame-btn"==e.target.id&&(w(0),T("game"))});let i=document.createElement("button");i.innerText="Continue",i.setAttribute("id","vngine-menu-continue-btn"),i.classList.add("vngine-btn"),document.addEventListener("click",e=>{e.target&&"vngine-menu-continue-btn"==e.target.id&&T("savefiles")});let d=document.createElement("button");d.innerText="Settings",d.setAttribute("id","vngine-menu-settings-btn"),d.classList.add("vngine-btn"),document.addEventListener("click",e=>{e.target&&"vngine-menu-settings-btn"==e.target.id&&T("settings")}),e.appendChild(n),e.appendChild(i),e.appendChild(d),a.appendChild(e),t.appendChild(a)}(),d=document.createElement("div"),function(){(l=document.createElement("div")).setAttribute("id","vngine-savefiles"),l.classList.add("vngine-screen","vngine-savefiles");let n=document.createElement("div");n.setAttribute("id","vngine-savefiles-header"),n.classList.add("vngine-savefiles-header");let i=document.createElement("p");i.setAttribute("id","vngine-savefiles-header-text"),i.classList.add("vngine-savefiles-header-text"),i.innerText="Load",(k=document.createElement("div")).setAttribute("id","vngine-savefile-list"),k.classList.add("vngine-savefile-list"),function(){if(!k)return;for(let e=0;e<C.length;e++)document.removeEventListener("click",C[e]);C.splice(0,C.length);let t=Object.keys(localStorage);for(let n=0;n<t.length;n++){let i=t[n],a=JSON.parse(localStorage.getItem(i));console.log(a);let d=document.createElement("div");d.setAttribute("id",`vngine-savefile-${i}`),d.classList.add("vngine-savefile");let l=document.createElement("div");l.classList.add("vngine-savefile-picture"),e.nodes[a.nodeIndex].background&&(l.style.backgroundImage=`url(game/res/img/backgrounds/${e.nodes[a.nodeIndex].background})`);let r=document.createElement("h1");r.classList.add("vngine-savefile-name"),r.innerText=i;let c=document.createElement("p");c.classList.add("vngine-savefile-sentence"),e.nodes[a.nodeIndex].dialog?c.innerText=e.nodes[a.nodeIndex].dialog[a.dialogIndex].text:c.innerHTML="<i>Decision</i>";let s=document.createElement("button");s.innerText="Load",s.setAttribute("id",`load-${i}`),s.classList.add("vngine-btn","vngine-btn-small"),C[n]=function(e){e.target&&e.target.id==`load-${i}`&&$(i)},document.addEventListener("click",C[n]);let o=document.createElement("button");o.innerText="Delete",o.setAttribute("id",`delete-${i}`),o.classList.add("vngine-btn","vngine-btn-small"),d.appendChild(l),d.appendChild(r),d.appendChild(c),d.appendChild(s),d.appendChild(o),k.appendChild(d)}}(),n.appendChild(i),l.appendChild(n),l.appendChild(k),t.appendChild(l)}(),T("loading"),a.innerHTML+=e.title+" by "+e.author,T("menu")},window.addEventListener("keydown",e=>{"Space"==e.code&&(A||(N(),A=!0))}),window.addEventListener("keyup",e=>{"Space"==e.code&&(A=!1)})}();
